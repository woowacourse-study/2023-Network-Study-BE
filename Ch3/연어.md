# Ch3 케이블의 앞은 LAN 기기였다
### 케이블과 리피터, 허브 속을 신호가 흘러간다
* 리피터 허브, 스위칭 허브, 라우터 등을 통해 이더넷이 연결됨
* 리피터 허브는 들어온 RJ-45 포트 이외의 모든 곳으로 출력
* TP 케이블이 꼬여있는 이유는 잡음을 상쇄하기 위함
    * 꼬임선이 4쌍이 들어있는데 꼬임 간격을 조정하여 서로 상쇄되지 않도록 함
    * 카테고리에 따라서 성능이 다름

### 스위칭 허브의 패킷 중계 동작
* 스위칭 허브는 MAC 주소와 포트를 등록한 테이블로 중계함
* 스위치 회로를 통해 여러 신호 동시에 중계 가능
* 송수신을 하면서 MAC 주소 테이블을 최신화
    * 시간이 지난 내용은 삭제
* 송수신 포트가 같은 경우 폐기
* 전이중 모드는 송수신 동시, 반이중 모드는 동시에 안됨
* Auto-Negotiation을 통해 양쪽이 전이중 모드를 지원하면 전이중 모드로 함

### 라우터의 패킷 중계 동작
* 라우터는 스위칭 허브와 비슷하지만 IP를 사용
* 라우터는 유무선 LAN 이외에도 ADSL, FTTH 등의 광대역 회선도 지원함
    * 포트 부분의 하드웨어에 따라 통신 규칙이 달라짐
* 라우팅 테이블 구성
    * 수신처, 넷마스크, 게이트웨이, 인터페이스, 메트릭 등으로 테이블 구성
    * 넷마스크를 사용해서 일괄적으로 여러 개의 서브넷을 등록
    * 메트릭은 가까운 지 멀리 있는 지를 표시
* 라우팅 테이블은 수동 또는 라우팅 프로토콜로 자동 갱신 가능
    * RIP, OSPF, BGP 등의 알고리즘
* 패킷을 수신하고 중계하는 과정
    * 패킷을 받으면 버퍼에 저장, FCS 대조로 오류 유무 검사
    * 네트워크 부분을 통해 후보들을 찾고 가장 비슷한 곳(네트워크 부분이 긴 곳)으로 중계
    * 가장 비슷한 곳이 여러 개면 메트릭을 통해 값이 작은 쪽으로 중계
    * 중계할 곳이 하나도 없다면 ICMP로 송신처에 통지
    * 게이트웨이가 있다면 게이트웨이로 중계
* 패킷의 TTL이 경유지마다 1씩 줄어들다가 0이 되면 패킷 폐기
    * 싸이클을 막기 위함
* 패킷의 크기가 MTU 크면 TCP처럼 Fragmentation 진행
    * TCP는 데이터 상태에서 나누지만 이것은 패킷 상태에서 분할
    * IP 헤더의 플래그 필드에서 분할해도 되는지 확인
* 이후 포트에 연결된 통신 회선의 규칙에 따라 패킷 송신
* 라우터는 IP를 중심으로 만들어졌고, 스위칭 허브는 이더넷을 중심으로 만들어짐

### 라우터의 부가 기능
* 주소 변환
    * 글로벌 주소가 아닌 프라이비트 주소는 어느 서브넷에서도 중복돼도 됨
    * 패킷을 내보낼 때, private -> global 변환 이후 포트 번호도 미사용 포트로 변환
    * 바꾸기 전의 주소, 포트 번호와 바꾼 이후의 주소, 포트 번호를 변환 장치 내부 테이블에 저장
    * 패킷을 받을 때는 변환 장치 내부 테이블과 대조해서 서브넷으로 전달
    * 포트 번호를 쓰는 이유는 서브넷의 여러 기기가 인터넷과 연결되기 위함
        * 주소만 바꾸면 global : private = 1 : 1
    * 변환 장치 내부 테이블에 정보가 없으면 외부에서 패킷이 들어오지 못함
* 패킷 필터링
    * MAC, IP, TCP 등의 조건으로 패킷을 필터링 하는 기능(방화벽)
