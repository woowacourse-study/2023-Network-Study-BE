## 케이블과 리피터 허브속을 신호가 흘러간다.

### 1. 하나하나의 패킷이 독립된 것으로 동작한다.

패킷은 중계장치를 통해 이동하는데 이는 데이터 부분을 보지 않고 패킷을 중계한다.

이 패킷은 클라이언트에서 리피터 허브, 스위칭 허브, 라우터를 경유하여 인터넷에 나간다.

### 2. Lan 케이블은 신호를 약화시키지 않는 것이 핵심이다.

Lan 어댑터에서 패킷이 송신되는데 이는 PHY회로에서 전기신호로 바꾼 패킷이다.

이 신호는 케이블을 흘러 리피터 허브의 커넥터 부분에 도착한다.

도착한 신호는 잡음 등의 이유로 신호가 약해진다. 이럴 경우 통신 오류의 원인이 된다.

### 3. ‘꼼’은 잡음을 방지하기 위한 방법이다.

Lan 케이블인 트위스트 페어 케이블(꼰 선쌍)은 잡음영향을 억제하는 대책이 있다. (꼼)

신호선을 마주 꼬아 잡음을 막을 수 있다.

잡음이란 케이블 주위 전자파에 의해 생긴 잡음 전류를 의미한다.

외부 모터, 기계 등에서 발생하는 잡음은 신호선을 나선형으로 마주꼼으로써 전류의 방향을 반대로 만들어 해결한다.(상쇄)

케이블 안 인접 신호선에서 누설된 전자파(크로스토크)는 거리가 가까운 문제가 있는데 케이블간 간격을 다르게 함으로써 잡음의 영향을 줄일 수 있다.

### 4. 리피터 허브는 연결되어 있는 전체 케이블에 신호를 송신한다.

리피터 허브란 전체에 패킷의 신호를 뿌리고 수신처 MAC 주소에 해당하는 기기만 패킷을 수신하게한다.

신호선을 왜 교차시켜야하지 ? → 한쪽의 송신을 다른쪽의 수신에 연결하기 위함 ?

리피터 회로는 들어오는 신호를 리피터 허브의 커넥터 부분에 송출하는 것이다. 이후 신호는 리피터 허브에 접속한 전체 기기에 도달한다. mac 주소를 조사하여 수신처면 수신하고 아니면 무시한다.

## 스위칭 허브의 패킷 중계 동작

### 1. 스위칭 허브는 주소 테이블로 중계한다.

스위칭 허브는 이더넷의 패킷을 그대로 목적지로 향하게 한다.

스위치 내부에 mac,포트 번호 테이블이 있는데 이것을 통해 어디에 송신해야할지 판단한다.

스위칭 허브 의 신호가 커넥터 부분에 도달하여 PHY 회로에서 수신되는 부분까지는 리피터 허브와 동일하다.  이 부분은 LAN 어댑터와 거의 같고 각 스위칭 허브의 커넥터 안쪽에는 LAN 어댑터와 같은 회로가 존재한다.

스위칭 허브의 포트는 MAC 주소를 검사하지 않고 모든 패킷을 수신하여 버퍼 메모리에 저장하기 때문에 스위칭 허브의 포트에는 LAN 어댑터와 달리 MAC 주소가 할당되어 있지 않다.

패킷을 버퍼 메모리에 저장하면 MAC 주소와 일치하는 것이 MAC 주소표에 등록되어 있는 지 조사한다. 주소표에 수신처 주소와 동일한 MAC 주소가 존재하면 주소표에쓰여있는 포트 위치에 패킷을 송신한다.

포트사이에 패킷을 운반할 때는 **스위치 회로** 에 패킷의 신호를 흘린다. 이처럼 신호의 교점에 있는 스위치는 각각 독립적으로 움직이므로 신호가 중복되지 않으면 복수의 신호를 흘릴 수 있다.

### 2. mac 주소 테이블을 등록 및 갱신한다.

두 종류의 갱신 동작을 한다.

1. 패킷 수신했을 때 송신처 mac 주소 조사
    1. 스위칭 허브는 패킷 수신마다 이동작 실행하여 등록한다.
2. 일정 시간 경과 시 삭제

따라서 mac 주소 테이블을 따로 등록 및 삭제할 필요가 없다.

### 3. 예외적인 동작

수신한 포트와 송신하는 포트가 같을 경우 패킷을 중계하지 않고 폐기한다.

### 4. 전이중 모드에서 송신과 수신을 동시에 실행한다.

전이중 모드 인 송신과 수신을 동시에 실행할 수 있는 성질도 리피터 허브에 없는 스위칭 허브의 특징이다.
리피터 허브 사용시 여러대가 송신하면 신호가 파괴될 수 있다. 전이중 동작의 경우 이 역할을 무효로 만든다.

### 5. 최적의 전송 속도로 보내는 자동 조정

접속 상대가 전이중 모드를 지원하는지 검출하고 자동으로 동작모드를 전환하는데 이것을 자동조정이라고 한다.

이더넷은 데이터가 흐르고 있지 않을 때는 **링크 펄스**라는 펄스형의 신호를 흘린다. 케이블의 상태를 확인하고

펄스 신호를 이용해 상대가 어떤 모드를 지원하는지 조사한다.

### 6. 스위칭 허브는 복수의 중계 동작을 동시에 실행한다.

스위칭 허브는 사용하고 있는 포트 외의 다른 포트를 통해 여러개의 패킷을 중계할 수 있다.

리피터 허브는 들어온 신호를 모든 포트에 뿌리므로 동시에 두 개 이상의 신호를 흘릴 수 없다.

## 라우터의 패킷 중계

### 1. 라우터의 기본

중계 대상을 등록한 표를 보고 어디로 중계해야할지 판단한다. IP를 통해 판단한다. 다만 스위칭 허브는 이더넷으로 판단한다.

중계 부분과 포트 부분으로 나누어져 있다.

- 중계 부분
    - 패킷의 중계 대상을 판단하는 동작을 담당
- 포트 부분
    - 패킷을 송/수신하는 동작을 담당

라우터의 각 포트에는 MAC 주소와 IP 주소가 할당되어 있다.

라우터는 IP 주소로 중계 대상을 판단한다.

### 경로표를 검색하여 출력 포트를 발견한다

라우터는 패킷 수신 동작이 끝나면 맨 앞의 MAC 헤더를 폐기한다.

MAC 헤더의 역할은 해당 라우터에 패킷을 건네주는 것

MAC 헤더의 수신처 MAC 주소 항목에 라우터의 포트에 할당한 MAC 주소가 기록되어 있다.

### 패킷은 유효 기한이 있다

경로표에서 중계 대상을 찾으면 패킷을 출력측의 포트로 옮기고 송신하는데, TTL(TIme To Live 생존 기간)이라는 IP헤더의 필드를 갱신한다. 패킷이 같은 장소를 순환하는 사태를 막기 위해 TTL은 라우터를 경유할 때 마다 값을 1씩 줄이다가 0이 되면 폐기한다.

### 큰 패킷은 조각 나누기 기능으로 분할한다

중계하는 패킷의 크기가 출력측의 패킷 최대 길이를 초과하면 그대로 패킷을 송신할 수 없다. 이 경우 IP 프로토콜에 규정된 조각 나누기(fragmentation)이라는 방법을 사용하여 패킷을 분할하고 패킷의 길이를 짧게 만든 후 중계한다.

### 라우터와 스위칭 허브의 관계

IP라는 구조는 스스로 패킷을 운반하는 수단이 없으므로 패킷을 운반할 때는 이더넷에 의뢰하여 운반한다. 라우터는 IP의 개념에 기초하여 만들어졌고, 스위칭 허브는 이더넷에 기초하여 만들어졌다.

라우터는 패킷을 운반하는 일을 스위칭 허브에 의뢰한다. 통신 상대까지 패킷을 전달하는 전체의 동작은 IP(라우터)가 담당하고, 이더넷(스위칭 허브)가 다음 라우터까지 패킷을 운반한다.

## 라우터의 부가 기능

사내용 주소로 프라이빗 주소, 고유한 주소로 글로벌 주소를 사용한다.

주소 변환 장치 내부에 있는 대응표에 글로벌 주소와 프라이비트 주소를 기록해 둔다.

주소 변환의 구조는 패킷을 중계할 때 IP 헤더에 기재된 IP주소와 포트 번호를 바꿔서 패킷을 사내용 주소로 변경한다.
